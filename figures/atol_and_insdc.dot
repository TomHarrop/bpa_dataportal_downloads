digraph {
    // viridis1 = "#440154";
    // viridis2 = "#31688e";
    // viridis3 = "#35b779";

    fontname = "lato";
    fontsize = "10";
    bgcolor = transparent;
    size = "13.33,7.5";
    dpi = 300;
    rankdir = LR; // Set the layout direction to left-to-right
    compound = true;
    splines = true;

    node [
        fontname = "lato";
        fontsize = "10";
        labelloc = "b";
        imagepos = "tc";
        shape = solid;
        color=none;
        fixedsize = true;
        height = 1.2;
        width = 1;
        imagescale = true;
    ];

    edge [
        fontname = "lato";
        fontsize = "10";
]

    // Users
    bpapm [
        label = "BPA PM";
        image = "resources/png/7558197-512.png";
    ];
    lab [
        label = "Sequencing lab";
        image = "resources/png/7558264-512.png";

    ];
    researcher [
        label = "Researcher";
        image = "resources/png/7558198-512.png";

    ];

    // BPA data portal
    subgraph cluster_dp {
        label = "";
        compound = true;
        style=solid;
        color=none;
        subgraph cluster_dp1 {
            label="";
            style="dashed,rounded";
            color="#440154"            
        bpadb [
            label = "Data Portal";
            image = "resources/png/5079138-512.png";
            ];
        }
        bpa_logo [
            label = "";
            image = "resources/png/bioplatforms-australia-logo.png";
            height=1;
            imagepos="tc"
        ]
    }

    // AToL data management
    subgraph cluster_dm {
        label = "AToL Metadata Services";
        compound = true;
        style=solid;
        color=none;
        subgraph cluster_dm1{
            label="";
            style="dashed,rounded";
            color="#35b779"            
            new [
                label="Data Mapper";
                image = "resources/png/7455241-512.png";
            ];
                    broker [
            label = "Data Broker";
                            image = "resources/png/7626477-512.png";

        ];

        }
    }

    // External DBs
    subgraph cluster_insdc {
        label = "INSDC databases";
        compound = true;
        style=solid;
        color=none;
        subgraph cluster_ena {
            label = "";
            compound = true;
            style=invis;
            subgraph cluster_ena1{
                label="";
                style="dashed,rounded";
                color="#31688e"            
                ena [
                    label = "ENA";
                    image = "resources/png/5079138-512.png";
                ];
            }
            ena_logo [
                label = "";
                image = "resources/png/ENA_logo_2021.png";
                imagepos = "tc";
                height=0.5;
            ];
        }
        subgraph cluster_ncbi {
            label = "";
            compound = true;
            style=invis;
            subgraph cluster_ncbi1 {
                label="";
                style="dashed,rounded";
                color="#31688e"            
                bioproject [
                    label = "BioProject\nBioSample";
                    image = "resources/png/5079138-512.png";
                    height=1.3;
                ];
                taxonomy [
                    label = "Taxonomy";
                    image = "resources/png/5079138-512.png";
                ];
            }
            ncbi_logo [
                label = "";
                image = "resources/png/ncbi_blue_logo.jpg";
                imagepos = "tc";
                height=0.6;
            ];
        }
    }

    // Genome engine
    subgraph cluster_embl {
        label="EMBL-EBI components";
        compound = true;
        style=solid;
        color=none;
    subgraph cluster_embl0 {
        label="";
        style="dashed,rounded";
        color="#31688e"

        ingestion [
            label = "Data ingestion";
            image = "resources/png/7626477-512.png";
        ];
        portal [
            label = "AToL Portal";
            image = "resources/png/7604611-512.png";
        ];

    }
        embl_logo [
            label = "";
            image = "resources/png/EMBL_logo_colour-1-300x144.png";
            imagepos="tc";
            height=0.6;
        ];

    }

    subgraph cluster_ge {
        label = "AToL Genome Engine";
        compound = true;
        style=solid;
        color=none;
        subgraph cluster_ge0 {
            label = "";
            compound = true;
            style="dashed,rounded";
            color="#35b779"            ;
            atoldb [
                label = "AToL database";
                image = "resources/png/5079138-512.png";

            ];
            engine [
                label = "Launcher";
                image = "resources/png/7455241-512.png";

            ];
        
    }
    }


    // Pawsey pipelines
    subgraph cluster_pawsey {
        label="DToL pipelines";
        compound = true;
        style=solid;
        color=none;
        subgraph cluster_pawsey2 {
            label="";
            style="dashed,rounded";
            color="#31688e"            
            pipelines [
                label = "genomeassembly";
                image="resources/png/workflow-icon-7615546-512.png";
            ];
        };
        dtol_logo [
                label = "";
                image="resources/png/Wellcome_Sanger_Institute_Logo_Landscape_Digital_RGB_Full_Colour-768x264.png";
                height = 0.4;
            ];

    }
    

    // Edges
    bpapm,lab,researcher -> bpadb [ 
        lhead = cluster_dp 
        ];

    bpadb -> new [
    ];

    new -> broker [
        ];

    broker -> ena [
        ];

    ena -> bioproject [
        constraint=false;
        style=dashed

    ];

    bioproject, taxonomy -> ingestion [ 
        lhead=cluster_embl;
    ];

    ena-> ingestion [ 
        label="Metadata";
        lhead=cluster_embl;
    ]

    ingestion -> atoldb;
    atoldb -> engine[
    ];
    engine -> pipelines;

    atoldb -> portal;
 }